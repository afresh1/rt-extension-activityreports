<&| Elements/Wrapper, %ARGS, title => loc("Activity reports"), show_print_link => 0 &>
<& /Elements/ListActions, actions => \@actions &>

% if ($ReportType) {
<& /Widgets/SavedSearch:show, %ARGS, Action => 'index.html', self => $saved_search, Title => 'Saved Activity reports' &>
<& /Search/Elements/ActivityReport, %ARGS &>
% }

</&>

<%args>
$ReportType  => undef
$start => undef
$end   => undef
$query => undef
</%args>
<%init>
unless ($start) {
    my $then = RT::Date->new($session{'CurrentUser'});
    $then->Set(Format => 'Unix', Value => time - (86400*7));
    $ARGS{start} = substr($then->ISO,0,10);
}

unless ($end) {
    my $now = RT::Date->new($session{'CurrentUser'});
    $now->SetToNow();
    $ARGS{end} = substr($now->ISO,0,10);
}

$ARGS{ReportType} ||= $ARGS{type};
$ARGS{Start}      ||= $ARGS{start};
$ARGS{End}        ||= $ARGS{end};
$ARGS{Query}      ||= $ARGS{query};

my $saved_search = $m->comp( '/Widgets/SavedSearch:new',
    SearchType   => 'ActivityReport',
    SearchFields => [qw(Query ReportType Start End)] );

my @actions = $m->comp( '/Widgets/SavedSearch:process', args => \%ARGS, self => $saved_search );

</%init>
